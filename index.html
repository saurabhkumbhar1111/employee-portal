<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Employee Portal</title>
    <meta name="theme-color" content="#4a6da7">
    <meta name="description" content="Employee Portal for attendance and salary management">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/LDL_logo.png">
    <link rel="stylesheet" href="style.css" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Employee Portal">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/LDL_logo.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/LDL_logo.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/LDL_logo.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
    <div class="container">
        <!-- LOGIN PAGE -->
        <div id="login-page" class="page active">
            <div class="header">
                <h1>Employee Portal</h1>
            </div>

            <div class="card">
                <h2>Login</h2>
                <p class="login-description">Enter your Employee ID to Login</p>

                <div class="form-group">
                    <input type="text" id="employee-id" maxlength="8"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '')" placeholder="Enter your Employee ID" />
                    <div id="employee-id-error" class="error">Please enter a valid employee ID</div>
                </div>

                <div id="toast" class="toast">
                    <p id="otp-message" style="display:none; color:green; font-weight:500; margin-top:5px;"></p>

                </div>

                <button id="send-otp-btn">Send OTP</button>
                <div id="otp-section" class="otp-section">

                    <div class="form-group">
                        <label for="otp">Enter OTP</label>
                        <input type="text" id="otp" maxlength="6"
                            oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                            placeholder="Enter OTP sent to your phone" />
                        <div id="otp-error" class="error">Please enter a valid OTP</div>
                    </div>
                    <button id="verify-otp-btn">Verify OTP</button>
                </div>
            </div>
            <div>
                <label class="heading-design">App Tutorial Links:</label>
                <a href="https://labguruprodfilestore.blob.core.windows.net/ldepl/Hindi_Version.mp4" target="_blank"
                    rel="noopener noreferrer">
                    Hindi
                </a>
                &nbsp; &nbsp;

                <a href="https://labguruprodfilestore.blob.core.windows.net/ldepl/English_Version.mp4" target="_blank"
                    rel="noopener noreferrer">
                    English
                </a>
                &nbsp; &nbsp;
                <a href="https://labguruprodfilestore.blob.core.windows.net/ldepl/Marathi_Version.mp4" target="_blank"
                    rel="noopener noreferrer">
                    Marathi
                </a>
            </div>
        </div>

        <!-- MENU PAGE (Shown after login) -->
        <div id="menu-page" class="page">
            <div class="header">
                <button id="menu-toggle" class="menu-toggle" aria-label="Open menu">☰</button>

                <h1>Employee Portal</h1>
                <!-- <button id="top-logout-btn" class="logout-btn">Logout</button> -->
            </div>

            <!-- Sidebar (hidden until login) -->
            <aside id="sidebar" class="sidebar" aria-hidden="true">
                <div class="profile-info">
                    <h3 id="sidebar-employee-name">Employee</h3>
                    <p id="sidebar-employee-id">ID: -</p>
                </div>

                <nav class="sidebar-nav" aria-label="Main menu">
                    <a id="menu-home" href="javascript:void(0)">🏠 Home</a>
                    <a id="menu-profile" href="javascript:void(0)">👤 Profile</a>
                    <a id="menu-attendance" href="javascript:void(0)">🗓 Attendance</a>
                    <a id="menu-salary" href="javascript:void(0)">💰 Salary Slip</a>
                    <a id="menu-team-attendance" href="javascript:void(0)">👥 Team Attendance</a>
                </nav>


                <div style="flex:1"></div>
                <div style="padding:16px">
                    <button id="menu-logout" class="sidebar-logout">Logout</button>
                </div>
            </aside>

            <!-- Overlay -->
            <div id="sidebar-overlay" class="sidebar-overlay" aria-hidden="true"></div>

            <!-- Main content (profile shown by default) -->
            <main id="menu-content" style="margin:20px;">
                <!-- HOME PAGE -->
                <div id="home-page" class="card">
                    <h2>Welcome, <span id="home-employee-name">Employee</span> 👋</h2>
                    <p>Glad to have you on the Employee Portal.</p>
                </div>

                <!-- PROFILE PAGE -->
                <div class="card" id="profile-page" style="display:none;">
                    <h2>My Profile</h2>
                    <!-- PROFILE PHOTO -->
                    <img id="profile-pic" src="icons/LDL_logo.png" alt="Profile Picture" class="profile-pic">

                    <!-- Employee Basic Info -->
                    <div class="section">
                        <div class="field"><strong>Employee Code: </strong> <span id="employee-id-display"></span></div>
                        <div class="field"><strong>Employee Name: </strong> <span id="employee-full-name"></span></div>
                        <p><strong>Official Mobile No:</strong> <span id="employee-work-mobile"></span></p>
                        <div class="field"><strong>Official Email ID: </strong> <span id="employee-email"></span></div>
                    </div>

                    <!-- Personal Information -->
                    <div class="section">
                        <div class="section-title">👤 Personal Information</div>
                        <div class="more-details">
                            <p><strong>First Name (As per Aadhar Card):</strong> <span id="employee-first-name"></span>
                            </p>
                            <p><strong>Middle Name:</strong> <span id="employee-middle-name"></span></p>
                            <p><strong>Last Name (As per Aadhar Card):</strong> <span id="employee-last-name"></span>
                            </p>
                            <p><strong>Father Name:</strong> <span id="employee-father-name"></span></p>
                            <p><strong>Date of Birth (As per Aadhar Card):</strong> <span id="employee-dob"></span></p>
                            <p><strong>Gender:</strong> <span id="employee-gender"></span></p>
                            <p><strong>Religion:</strong> <span id="employee-religion"></span></p>
                            <p><strong>Marital Status:</strong> <span id="employee-marital-status"></span></p>
                            <p><strong>Blood Group:</strong> <span id="employee-blood-group"></span></p>
                        </div>
                    </div>

                    <!-- Contact Details -->
                    <div class="section">
                        <div class="section-title">📞 Contact Details</div>
                        <div class="more-details">
                            <div class="field"><strong> Personal Mobile No: </strong> <span id="employee-phone"></span>
                            </div>
                            <p><strong>Personal Email ID:</strong> <span id="employee-personal-email"></span></p>
                        </div>
                    </div>

                    <!-- Address Details -->
                    <div class="section">
                        <div class="section-title">🏠 Address</div>
                        <div class="more-details">
                            <p><strong>Present Address:</strong> <span id="employee-present-address"></span></p>
                            <p><strong>City/State/Pin:</strong>
                                <span id="employee-present-city"></span> /
                                <span id="employee-present-state"></span> /
                                <span id="employee-present-pincode"></span>
                            </p>
                            <p><strong>Permanent Address:</strong> <span id="employee-permanent-address"></span></p>
                            <p><strong>City/State/Pin:</strong>
                                <span id="employee-permanent-city"></span> /
                                <span id="employee-permanent-state"></span> /
                                <span id="employee-permanent-pincode"></span>
                            </p>
                        </div>
                    </div>

                    <!-- Work Information -->
                    <div class="section">
                        <div class="section-title">🏢 Work Information</div>
                        <div class="more-details">
                            <p><strong>Department:</strong> <span id="employee-department"></span></p>
                            <p><strong>Designation:</strong> <span id="employee-designation"></span></p>
                            <p><strong>Reporting Manager:</strong> <span id="employee-reporting-manager"></span></p>
                            <p><strong>Joining Branch:</strong> <span id="employee-branch"></span></p>
                            <p><strong>Work Location:</strong> <span id="employee-location"></span></p>
                        </div>
                    </div>

                    <!-- Government Details -->
                    <div class="section">
                        <div class="section-title">📝 Government Details</div>
                        <div class="more-details">
                            <p><strong>PAN No:</strong> <span id="employee-pan"></span></p>
                            <p><strong>UAN No:</strong> <span id="employee-uan"></span></p>
                            <p><strong>Aadhar Card No:</strong> <span id="employee-aadhar"></span></p>
                        </div>
                    </div>

                    <!-- Medical History -->
                    <div class="section">
                        <div class="section-title">❤️ Medical History</div>
                        <div class="more-details">
                            <p><span id="employee-medical-history"></span></p>
                        </div>
                    </div>

                    <!-- ACTION BUTTONS -->
                    <div class="profile-actions">
                        <label class="profile-label">Click below to update the above information if any:</label>

                        <div class="ack-row">
                            <button class="btn-ack-update" onclick="redirectToUpdateForm()">
                                <span class="ack-text1">✎ Update</span>
                            </button>
                        </div>

                        <label class="profile-label">Is the above information correct?</label>

                        <div class="ack-row">
                            <button class="btn-ack" onclick="submitAcknowledgement('Acknowledged & All Correct')">
                                <span class="ack-text">✔ Acknowledged & All Correct</span>
                            </button>
                        </div>

                        <div class="ack-row">
                            <button class="btn-ack-wrong"
                                onclick="submitAcknowledgement('Acknowledged but Changes Required')">
                                <span class="ack-text">⚠ Acknowledged but Changes Required</span>
                            </button>
                        </div>

                    </div>
                </div>
            </main>
        </div>

        <!-- ATTENDANCE PAGE -->
        <div id="attendance-page" class="page">
            <div class="header">
                <h1>Attendance</h1>
                <button class="logout-btn" id="attendance-logout-btn">Logout</button>
            </div>

            <div class="card">
                <button class="back-btn secondary" id="attendance-back-btn">← Back</button>

                <div class="calendar-header">
                    <button id="prev-month-btn">←</button>
                    <h2 id="current-month"></h2>
                    <button id="next-month-btn">→</button>
                </div>

                <div id="calendar-legend" style="display: flex; gap: 5px; padding-bottom: 0.2rem; font-size: 0.7rem;">
                    <span
                        style="background-color: #a5d6a7; padding: 3px 6px; border-radius: 6px;"><strong>P</strong>Present</span>
                    <span
                        style="background-color: #ef9a9a; padding: 3px 6px; border-radius: 6px;"><strong>A</strong>Absent</span>
                    <span
                        style="background-color: #fff59d; padding: 3px 6px; border-radius: 6px;"><strong>H</strong>Holiday</span>
                    <span
                        style="background-color: #f0f0f0; padding: 3px 6px; border-radius: 6px;"><strong>W</strong>Weekend</span>
                </div>

                <div class="calendar-wrapper">
                    <table class="calendar">
                        <thead>
                            <tr>
                                <th>Sun</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                                <th>Sat</th>
                            </tr>
                        </thead>
                        <tbody id="calendar-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Attendance Popup -->
        <div id="attendance-popup" class="attendance-popup">
            <div class="attendance-popup-content">
                <span id="popup-close">&times;</span>
                <h3>Attendance Details</h3>
                <p><strong>In Time:</strong> <span id="popup-intime">-</span></p>
                <p><strong>Out Time:</strong> <span id="popup-outtime">-</span></p>
            </div>
        </div>


        <!-- Loader -->
        <div id="attendance-loader" class="loader-overlay" style="display:none;">
            <div class="spinner"></div>
            <p>Loading attendance...</p>
        </div>

        <!-- SALARY PAGE -->
        <div id="salary-page" class="page">
            <div class="header">
                <h1>Salary Slips</h1>
                <button class="logout-btn" id="salary-logout-btn">Logout</button>
            </div>

            <div class="card">
                <button class="back-btn secondary" id="salary-back-btn">← Back</button>
                <p class="salary-description">Download your salary slip here.</p>
                <div class="month-list" id="month-list"></div>
                <div id="salary-slip" class="salary-slip"></div>
            </div>
        </div>


        <!-- TEAM ATENDANCE PAGE -->
        <div id="team-attendance-page" class="page">
            <div class="header">
                <h1>Team Attendance</h1>
                <button class="logout-btn" onclick="authManager.logout()">Logout</button>
            </div>

            <div class="card">
                <button class="back-btn secondary" onclick="employeePortal.showPage('menu')">← Back</button>

                <div id="team-select-container" class="team-dropdown-wrapper" style="padding-bottom: 11px;">
                    <div class="custom-dropdown" id="teamCustomDropdown">
                        <div class="dropdown-selected">
                            <span id="teamSelectedText">-- Select Employee --</span>
                            <span class="dropdown-arrow">▼</span>
                        </div>
                        <div class="dropdown-menu">
                            <input type="text" id="teamEmployeeSearch" class="dropdown-search"
                                placeholder="Search employee..." />
                            <div class="dropdown-options" id="teamDropdownOptions"></div>
                        </div>
                    </div>

                </div>

                <div id="team-empty-state" class="empty-state">
                    <div class="empty-icon">👥</div>
                    <h3>No Employee Selected</h3>
                    <p>Please select an employee from the dropdown to view attendance.</p>
                </div>

                <div id="team-calendar-section" style="display:none;">

                    <div class="calendar-header">
                        <button id="team-prev-month-btn">←</button>
                        <h2 id="team-current-month"></h2>
                        <button id="team-next-month-btn">→</button>
                    </div>

                    <div id="calendar-legend" class="calendar-legend">
                        <span class="legend present"><strong>P</strong> Present</span>
                        <span class="legend absent"><strong>A</strong> Absent</span>
                        <span class="legend holiday"><strong>H</strong> Holiday</span>
                        <span class="legend weekend"><strong>W</strong> Weekend</span>
                    </div>

                    <div class="calendar-wrapper">
                        <table class="calendar">
                            <thead>
                                <tr>
                                    <th>Sun</th>
                                    <th>Mon</th>
                                    <th>Tue</th>
                                    <th>Wed</th>
                                    <th>Thu</th>
                                    <th>Fri</th>
                                    <th>Sat</th>
                                </tr>
                            </thead>
                            <tbody id="team-calendar-body"></tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- JS (auth first so login UI works) -->
    <script src="auth.js"></script>
    <script src="attendance.js"></script>
    <script src="salary.js"></script>
    <script src="app.js"></script>
    <!-- <script src="tour.js"></script> -->
    <script src="config.js"></script>

    <button id="installAppBtn" style="
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 10002;
      background-color: #4a6da7;
      color: white;
      border: none;
      border-radius: 30px;
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      display: none;
    ">
        ⬇️ Install App
    </button>

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker
                .register("sw.js");
        }

        let deferredPrompt;
        const installBtn = document.getElementById("installAppBtn");

        window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = "block";
        });

        installBtn.addEventListener("click", async () => {
            installBtn.style.display = "none";
            deferredPrompt.prompt();
            const choiceResult = await deferredPrompt.userChoice;
            deferredPrompt = null;
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.section-title').forEach(function (title) {
                const details = title.nextElementSibling;

                // ensure collapsed initially
                details.classList.remove('show');

                title.addEventListener('click', function () {
                    details.classList.toggle('show');
                });
            });
        });

    </script>
    <script>
        document.querySelectorAll('.section').forEach(section => {
            const title = section.querySelector('.section-title');
            if (title) {
                title.addEventListener('click', () => {
                    section.classList.toggle('active');
                });
            }
        });
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-messaging-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDt4mOvMltx0V7Ujs98t8jHgvu8pyzNyH4",
            authDomain: "empportal-c733f.firebaseapp.com",
            projectId: "empportal-c733f",
            storageBucket: "empportal-c733f.firebasestorage.app",
            messagingSenderId: "702851978485",
            appId: "1:702851978485:web:e360d3ef51cbeeb2e761bc",
        };

        firebase.initializeApp(firebaseConfig);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then((registration) => {
                    // console.log('✅ Service Worker Registered', registration);
                    const messaging = firebase.messaging();
                    messaging.getToken({
                        vapidKey: 'BLXIFrzowad4LYjYFWv8_JEnyGYPcQ7bXNvt6_Szy7HK8o22gcHOVbkvrr99qCIxpx9ijIQyZcS68GUBT0DlrCY',
                        serviceWorkerRegistration: registration
                    });

                })
                .catch((err) => console.error('SW registration failed:', err));
        } else {
            console.error('Service Workers not supported in this browser.');
        }
    </script>
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.addEventListener("controllerchange", () => {
                window.location.reload();
            });
        }
    </script>
</body>

</html>